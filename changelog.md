# Changelog

## [Unreleased]

### Added
- Улучшенная категоризация поисковых запросов:
  - Новые категории: доставка_город, доставка_общий, коммерческий, информационный, прочее
  - Автоматическое определение категорий на основе ключевых слов
  - Скрипт для обновления категорий исторических данных
- Анализ поисковых запросов по городам:
  - Добавлен класс CityAnalyzer для анализа статистики по городам
  - Улучшенные SQL запросы с обработкой NULL значений
  - Детальное логирование процесса анализа
- Интеграция с CRM API:
  - Добавлена таблица crm_orders для хранения заказов
  - Реализован скрипт для получения и сохранения заказов
  - Автоматическое обновление данных о заказах
  - Статистика по статусам заказов

### Changed
- Обновлен скрипт анализа позиций:
  - Группировка по новым категориям запросов
  - Улучшенная фильтрация значимых изменений
  - Более детальная статистика по изменениям
- Оптимизирована обработка статистики:
  - Добавлено использование COALESCE для корректной обработки NULL значений
  - Улучшена точность расчета метрик (клики, показы, CTR, позиции)

### Fixed
- Исправлена обработка старых категорий в базе данных
- Улучшена точность категоризации
- Исправлены SQL запросы для корректной работы с городами
- Добавлена обработка ошибок при анализе данных

## [2024-12-13]
### Added
- Добавлен сервис `AnalyticsService` для работы с Google Analytics API
- Добавлен скрипт `setup_analytics_credentials.py` для настройки учетных данных GA4
### Changed
- Обновлена структура работы с Google Analytics API для использования сервисного аккаунта

## [2024-12-11] - Интеграция с Supabase и создание структуры базы данных

### Добавлено
- Создана структура базы данных в Supabase для хранения SEO метрик
- Реализованы таблицы для хранения данных по городам и поисковым запросам
- Добавлены таблицы для ежедневных, недельных и месячных метрик
- Создана система отслеживания изменений позиций и аномалий
- Настроены индексы для оптимизации запросов

### Улучшено
- Реализована система версионирования данных через timestamps
- Добавлены внешние ключи для обеспечения целостности данных
- Оптимизирована структура таблиц для эффективного хранения и запросов

### Технические детали
- Настроено подключение к Supabase через пул соединений
- Реализованы триггеры для автоматического обновления временных меток
- Добавлены индексы для часто используемых полей
- Создана документация по структуре базы данных

## [2024-12-11] - Улучшение анализа SEO данных

### Добавлено
- Категоризация поисковых запросов по городам и типам
- Детальный анализ запросов с доставкой по городам
- Группировка похожих запросов (например, "доставка цветов алматы" и "цветы алматы доставка")
- Статистика по позициям в поисковой выдаче для каждого города

### Изменено
- Упрощен код сбора данных из Google Search Console
- Улучшен формат вывода статистики
- Оптимизирована обработка данных для более точного анализа

### Исправлено
- Удалены избыточные временные измерения для улучшения производительности
- Исправлена обработка дубликатов в запросах
- Улучшена обработка пустых значений в данных

### Технические детали
- Обновлен `GSCCollector` для более эффективного сбора данных
- Добавлены новые функции анализа в `analyze_cvety_data.py`
- Реализована новая система категоризации запросов
- Добавлено сохранение результатов анализа в CSV файлы

### Следующие шаги
- Добавить анализ сезонности для каждого города
- Улучшить отслеживание конверсий по типам запросов
- Реализовать автоматические рекомендации по оптимизации позиций

## [1.0.0] - 2023-12-13

### Added
- Базовый функционал для работы с Google Search Console API
- Система хранения данных в Supabase
- Базовый анализ позиций и CTR
